<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://xmlns.jcp.org/jsf/passthrough">


<h:head>
	<h:outputStylesheet library="css" name="bootstrap.min.css" />
</h:head>


<h:body>
	<ui:composition>

		<h:form id="modalForm">

			<div class="modal" id="exampleModal" tabindex="-1" role="dialog"
				aria-labelledby="exampleModalLabel" aria-hidden="true"
				style="width: 1000px; height: 750px; margin-left: 500px;">
				<div class="modal-dialog modal-lg" role="dialog">
					<div class="modal-content" style="height: 680px;" id="modalContent">
						<div class="modal-header">
							<h5 class="modal-title" id="exampleModalLabel">New Item</h5>
							<button type="button" class="close" data-dismiss="modal"
								aria-label="Close">
								<span aria-hidden="true" />
							</button>
						</div>
						<div class="row" style="height: 500px">
							<div class="col-md-6">
								<div class="modal-body" style="overflow-y: inherit;">
									<div class="form-group">
										<div class="row justify-content-center">
											<div class="col-md-3">
												<h:outputText value="Name" />
											</div>
											<div class="col-md-9">
												<h:inputText id="modalNameInput" class="input-block-level"
													value="#{item.itemDTO.name}"
													validator="#{item.validateName}">
													<f:ajax event="blur" render="modalNameMessage" />
												</h:inputText>

											</div>

										</div>
									</div>
									<div class="form-group">
										<div class="row justify-content-center">
											<div class="col-md-3">
												<h:outputText value="Description" />
											</div>
											<div class="col-md-9">
												<h:inputText class="input-block-level"
													id="modalDescriptionInput"
													value="#{item.itemDTO.description}"
													validator="#{item.validateDescription}">
													<f:ajax event="blur" render="modalDescriptionMessage" />
												</h:inputText>

											</div>
										</div>
									</div>
									<div class="form-group">
										<div class="row justify-content-center">
											<div class="col-md-3">
												<h:outputText value="Category" />
											</div>
											<div class="col-md-9">
												<h:inputText id="modalCategory" readonly="true"
													class="input-block-level">
												</h:inputText>
												
												<h:inputHidden id="hiddenCategory"
													value="#{item.categoryID}" />
													
											</div>
										</div>
									</div>
									<div class="form-group">
										<div class="row justify-content-center">
											<div class="col-md-3">
												<h:outputText value="Initial Price" />
											</div>
											<div class="col-md-9">
												<h:inputText value="#{item.itemDTO.initialPrice}"
													id="modalInitialPriceInput" class="input-block-level"
													validator="#{item.validatePrice}">
													<f:ajax event="blur" render="modalInitialPriceMessage" />
												</h:inputText>

											</div>
										</div>
									</div>
									<div class="form-group">
										<div class="row justify-content-center">
											<div class="col-md-3">
												<h:outputText value="Opening date"
													styleClass="control-label" />
											</div>
											<div class="col-md-9">
												<div class="input-group date">
													<h:inputText class="input-block-level"
														id="openingDatePicker" value="#{item.openingDate}"
														validator="#{item.validateDate}">
														<f:ajax event="blur" render="modalOpeningDateMessage" />
													</h:inputText>
													<span class="input-group-addon" id="openingDateIcon"><i
														class="typcn typcn-calendar" /> </span>

												</div>
											</div>

										</div>

										<div class="row justify-content-center">
											<div class="col-md-3" />
											<div class="col-md-9">
												<div class="input-group bootstrap-timepicker timepicker"
													id="openingDateInput">
													<h:inputText id="openingTimePicker"
														class="input-block-level" value="#{item.openingTime}" />
													<span class="input-group-addon"><i
														class="typcn typcn-time"></i></span>
												</div>

												<script type="text/javascript">
                 					   $('#modalForm\\:openingTimePicker').timepicker({
                       					 icons: {
                         				 up: 'typcn typcn-arrow-up',
                         				 down: 'typcn typcn-arrow-down'
                     				     }
                  						    });
              						  </script>
											</div>
										</div>
									</div>

									<div class="form-group">
										<div class="row justify-content-center">
											<div class="col-md-3">
												<h:outputText value="Closing date"
													styleClass="control-label  " />
											</div>

											<div class="col-md-9">
												<div class="input-group date">
													<h:inputText class="input-block-level"
														id="closingDatePicker" value="#{item.closingDate}"
														validator="#{item.validateDate}">
														<f:ajax event="blur" render="modalClosingDateMessage" />
													</h:inputText>
													<span class="input-group-addon" id="closingDateIcon"><i
														class="typcn typcn-calendar" /> </span>
												</div>
											</div>
										</div>
										<div class="row justify-content-center"></div>
										<div class="row justify-content-center">
											<div class="col-md-3" />
											<div class="col-md-9">
												<div class="input-group bootstrap-timepicker timepicker">
													<h:inputText id="closingTimePicker"
														class="input-block-level" value="#{item.closingTime}" />
													<span class="input-group-addon"><i
														class="typcn typcn-time"></i></span>
												</div>
												<script type="text/javascript">
                 					   $('#modalForm\\:closingTimePicker').timepicker({
                     
                       					 icons: {
                         				 up: 'typcn typcn-arrow-up',
                         				 down: 'typcn typcn-arrow-down'
                     				     }
                  						    });
              						  </script>
											</div>
										</div>

									</div>
									<div class="form-group">
										<div class="row">
											<div class="col-md-3" />
											<div class="col-md-3">
												<button type="button" class="btn btn-info"
													data-dismiss="modal">Close</button>
											</div>
											<div class="col-md-3">
												<h:commandButton action="#{item.addItem}"
													styleClass="btn btn-info" value="Save Item">
													<f:ajax execute="@this" render="itemDefiningForm" />
												</h:commandButton>
											</div>
										</div>
										<div class="row">
											<h:message id="modalNameMessage" for="modalNameInput" />
										</div>
										<div class="row">
											<h:message id="modalDescriptionMessage"
												for="modalDescriptionInput" />
										</div>
										<div class="row">
											<h:message id="modalInitialPriceMessage"
												for="modalInitialPriceInput" />
										</div>
										<div class="row">
											<h:message for="openingDatePicker"
												id="modalOpeningDateMessage" />
										</div>
										<div class="row">
											<h:message for="closingDatePicker"
												id="modalClosingDateMessage" />
										</div>
									</div>
								</div>
							</div>
							<div class="col-md-6" style="padding-right: 40px;">
								<ui:include src="/items/item-category-tree.xhtml" />
							</div>
						</div>

					</div>
				</div>
			</div>
		</h:form>
		<ui:insert>
			<ui:include src="/items/buy-table.xhtml" />
		</ui:insert>

		<h:dataTable id="table" value="#{item.itemsToBuy}" var="itemDTO"
			styleClass="table table-stripped table-bordered dataTable no-footer "
			cellspacing="0" width="100%" role="grid" style="width: 100%;"
			headerClass="order-table-header"
			rowClasses="order-table-odd-row,order-table-even-row"
			rendered="#{item.tableTpye}">
			<h:messages for="itemDefiningForm:table" style="color:red" />
			<h:column>
				<f:facet name="header">Name</f:facet>
				<h:outputText value="#{itemDTO.name}" />
			</h:column>
			<h:column>
				<f:facet name="header">Description</f:facet>
				<h:outputText value="#{itemDTO.description}" />
			</h:column>
			<h:column>;
				<f:facet name="header">Category</f:facet>
				<h:outputText value="#{itemDTO.category.text}" />
			</h:column>
			<h:column>
				<f:facet name="header">BestBid</f:facet>
				<h:outputText value="#{itemDTO.bestBid}" />
			</h:column>
			<h:column>
				<f:facet name="header">OpeningDate</f:facet>
				<h:outputText value="#{itemDTO.openingDate}" />
			</h:column>
			<h:column>
				<f:facet name="header">Closing Date</f:facet>
				<h:outputText value="#{itemDTO.closingDate}" />
			</h:column>
			<h:column>
				<f:facet name="header">Opening Date</f:facet>
				<h:outputText value="#{itemDTO.status}" />
			</h:column>

		</h:dataTable>

		<h:form id="itemDefiningForm">

			<h:dataTable id="table" value="#{item.itemsToSell}" var="itemDTO"
				styleClass="table table-stripped table-bordered dataTable no-footer "
				cellspacing="0" width="100%" role="grid" style="width: 100%;"
				headerClass="order-table-header"
				rowClasses="order-table-odd-row,order-table-even-row"
				rendered="#{not item.tableTpye}">

				<h:column>
					<f:facet name="header">Name</f:facet>
					<h:inputText style="width:87%" class="form-control" id="tableName"
						value="#{itemDTO.name}" styleClass="form-control"
						rendered="#{itemDTO.editable}" validator="#{item.validateName}" />
					<h:message for="tableName" style="color:red" />
					<h:outputText value="#{itemDTO.name}"
						rendered="#{not itemDTO.editable}" />
				</h:column>

				<h:column>
					<f:facet name="header">Description</f:facet>
					<h:inputText style="width:87%" value="#{itemDTO.description}"
						id="tableDescription" rendered="#{itemDTO.editable}"
						validator="#{item.validateDescription}" />
					<h:message for="tableDescription" style="color:red" />
					<h:outputText value="#{itemDTO.description}"
						rendered="#{not itemDTO.editable}" />
				</h:column>

				<h:column>
					<f:facet name="header">Category</f:facet>
					<h:outputText value="#{itemDTO.category.text}" />
				</h:column>

				<h:column>
					<f:facet name="header">Initial price</f:facet>
					<h:inputText style="width:87%" value="#{itemDTO.initialPrice}"
						id="tableInitialPrice" styleClass="form-control"
						rendered="#{itemDTO.editable}" validator="#{item.validatePrice}" />
					<h:message for="tableInitialPrice" style="color:red" />
					<h:outputText value="#{itemDTO.initialPrice}"
						rendered="#{not itemDTO.editable}" />
				</h:column>

				<h:column>
					<f:facet name="header">Best bid</f:facet>
					<h:outputText value="#{itemDTO.bestBid}" />
				</h:column>

				<h:column>
					<f:facet name="header">Bids</f:facet>
					<h:outputText value="#{itemDTO.bids.size()}" />
				</h:column>



				<h:column>
					<f:facet name="header">Opening Date</f:facet>
					<h:outputText value="#{itemDTO.openingDate}" />
				</h:column>

				<h:column>
					<f:facet name="header">Closing Date</f:facet>
					<h:outputText value="#{itemDTO.closingDate}" />
				</h:column>

				<h:column>
					<f:facet name="header">Status</f:facet>
					<div class="form-group" style="width: 30%">

						<h:selectOneMenu id="status" rendered="#{itemDTO.editable}"
							value="#{itemDTO.status}">
							<f:selectItem itemValue="OPEN" itemLabel="OPEN" />
							<f:selectItem itemValue="CLOSED" itemLabel="CLOSED" />
							<f:selectItem itemValue="NOT YET OPEN" itemLabel="NOT YET OPEN" />
							<f:selectItem itemValue="ABANDONED" itemLabel="ABANDONED" />
						</h:selectOneMenu>
					</div>
					<h:outputText value="#{itemDTO.status}"
						rendered="#{not itemDTO.editable}" />
				</h:column>

				<h:column>
					<f:facet name="header">Edit</f:facet>
					<h:commandButton styleClass="btn btn-info btn-block" value="Edit"
						action="#{item.editAction(itemDTO)}"
						rendered="#{not itemDTO.editable}"
						disabled="#{item.statusCheck(itemDTO)}">
						<f:ajax execute="@form" render="itemDefiningForm" />
					</h:commandButton>
					<h:commandButton action="#{item.notEditable(itemDTO)}"
						value="Close" rendered="#{itemDTO.editable}"
						styleClass="btn btn-info btn-block">
						<f:ajax execute="@form" render="itemDefiningForm" />
					</h:commandButton>
				</h:column>
			</h:dataTable>
			<h:messages for="itemDefiningForm:table" />
			<div class="row">
				<div class="col-md-2">
					<h:commandButton styleClass="btn btn-success btn-block"
						value="Save Changes" action="#{item.saveAction}"
						rendered="#{not item.tableTpye}">
						<f:ajax execute="@form" render="itemDefiningForm" />
					</h:commandButton>
				</div>
				<div class="col-md-2">
					<h:commandButton id="buyItems"
						styleClass="btn btn-success btn-block"
						action="#{item.showBuyTable}" value="Buy Items"
						rendered="#{not item.tableTpye}" />
				</div>
				<div class="col-md-2">
					<h:commandButton type="button" id="myBtn"
						styleClass="btn btn-primary btn-block" p:data-toggle="modal"
						rendered="#{not item.tableTpye}" p:data-target="#exampleModal"
						value="New Item">
					</h:commandButton>
				</div>
			</div>
			<div class="row">
				<div class="col-md-2">
					<h:commandButton id="sellItems"
						styleClass="btn btn-success btn-block"
						action="#{item.showSellTable}" value="Sell Items"
						onclick="hideButton()" rendered="#{ item.tableTpye}" />
				</div>
			</div>

			<h:inputHidden id="hiddenOpeningDate" value="#{item.openingDate}" />
			<h:inputHidden id="hiddenClosingDate" value="#{item.closingDate}" />

			<script>
			$(document).ready(function() {
				$('#itemDefiningForm\\:table').DataTable();
				$('#table').DataTable();
			
				$("#modalForm\\:openingDatePicker").datepicker({
					format: 'yyyy/mm/dd'
				});
 				$("#openingDateIcon").datepicker({
					format: 'yyyy/mm/dd'
				});
				
				$("#modalForm\\:closingDatePicker").datepicker({
					format: 'yyyy/mm/dd'
				});

 				$("#closingDateIcon").datepicker({
					format: 'yyyy/mm/dd'
				});
				
				$("#modalForm\\:openingDatePicker").on('changeDate', function() {
				    $('#modalForm\\:hiddenOpeningDate').val(
				            $('#modalForm\\:openingDatePicker').datepicker('getFormattedDate')
				        );
				});
				
				$("#openingDateIcon").on('changeDate', function() {
				    $('#modalForm\\:hiddenOpeningDate').val(
				            $('#openingDateIcon').datepicker('getFormattedDate')
				        );
				});
				 
				
				
				$("#modalForm\\:closingDatePicker").on('changeDate', function() {
				    $('#modalForm\\:hiddenClosingDate').val(
				    	$('#modalForm\\:closingDatePicker').datepicker('getFormattedDate')
				    );
				});	

				
				$("#closingDateIcon").on('changeDate', function() {
				    $('#modalForm\\:hiddenOpeningDate').val(
				            $('#closingDateIcon').datepicker('getFormattedDate')
				        );
				});
				 

			});
			
			
		</script>
		</h:form>

	</ui:composition>

</h:body>

</html>